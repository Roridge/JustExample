package com.flowmellow.justexample.activities.adapters;

import java.util.Collections;
import java.util.LinkedHashMap;
import java.util.Map;

import android.graphics.Bitmap;

public class ImageCache {

	private Map<String, Bitmap> cache = Collections.synchronizedMap(new LinkedHashMap<String, Bitmap>(10, 1.5f, true));

	public Bitmap getImage(String url) {
		Bitmap image = null;

		if (cache.containsKey(url)) {
			image = cache.get(url);
		}
		return image;
	}

	public void putImage(String url, Bitmap bitmap) {
		checkCacheSize();
		cache.put(url, bitmap);
	}

	/**
	 * TODO with more time this could be implemented better to remove the oldest
	 * bitmaps if the memory is running low rather than clearing the whole
	 * thing.
	 */
	private void checkCacheSize() {

		long maxMemory = Runtime.getRuntime().maxMemory();
		long freeMemory = Runtime.getRuntime().freeMemory();

		// TODO choose better number
		if (maxMemory - 1000l < freeMemory) {
			clear();
		}
	}

	public void clear() {
		cache.clear();
	}
}
