package com.flowmellow.justexample.activities;

import com.flowmellow.justexample.R;
import com.flowmellow.justexample.services.LocationService;
import com.flowmellow.justexample.services.RestaurantService;
import com.flowmellow.justexample.services.RestaurantService.RestaurantBinder;

import android.app.Activity;
import android.content.ComponentName;
import android.content.Context;
import android.content.Intent;
import android.content.ServiceConnection;
import android.os.Bundle;
import android.os.IBinder;

public class RestaurantsActivity extends Activity {

	public static final String POSTCODE_INTENT = "POSTCODE_INTENT";
	private RestaurantService restaurantService;
	private ServiceConnection restaurantServiceConnection;
	private boolean isRestaurantServiceBound = false;
	private String postcode;

	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		setContentView(R.layout.activity_restaurants_list);

		final Intent intent = getIntent();

		if (intent.hasExtra(POSTCODE_INTENT)) {
			postcode = intent.getStringExtra(POSTCODE_INTENT);
		}

		if (postcode == null) {
			noRestaurantsFound();
		}

		restaurantServiceConnection = new RestaurantServiceConnection();
	}

	@Override
	protected void onStart() {
		super.onStart();

		// Bind to RestaurantService
		final Intent bindIntent = new Intent(this, LocationService.class);
		bindService(bindIntent, restaurantServiceConnection, Context.BIND_AUTO_CREATE);
	}

	@Override
	protected void onStop() {
		super.onStop();

		// Unbind from RestaurantService
		if (isRestaurantServiceBound) {
			unbindService(restaurantServiceConnection);
			isRestaurantServiceBound = false;
		}
	}

	protected void noRestaurantsFound() {

	}

	private class RestaurantServiceConnection implements ServiceConnection {

		@Override
		public void onServiceConnected(ComponentName className, IBinder service) {
			RestaurantBinder binder = (RestaurantBinder) service;
			restaurantService = binder.getService();
			isRestaurantServiceBound = true;
			restaurantService.requestRestaurant(postcode);
		}

		@Override
		public void onServiceDisconnected(ComponentName componentName) {
			isRestaurantServiceBound = false;
		}
	}
}